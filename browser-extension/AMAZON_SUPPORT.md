# Amazon商品信息提取支持

## ✅ 已实现功能

### 1. Amazon专用商品信息提取
- ✅ 商品名称提取（支持多个Amazon选择器）
- ✅ 价格提取（支持多种价格显示格式）
- ✅ ASIN（商品ID）提取
- ✅ 商品图片提取
- ✅ 评分和评论数提取

### 2. 支持的选择器

#### 商品名称
- `#productTitle` - 标准商品标题
- `h1.a-size-large.product-title-word-break` - 大标题格式
- `h1.a-size-base-plus` - 基础标题格式
- `#title > span.a-size-large` - 标题容器内的span

#### 商品价格
- `.a-price .a-offscreen` - 隐藏的完整价格（推荐）
- `.a-price-whole` - 价格整数部分
- `#priceblock_ourprice` - "我们的价格"
- `#priceblock_dealprice` - 优惠价格
- `#priceblock_saleprice` - 销售价格
- `span.a-price[data-a-color="price"]` - 通用价格容器

#### 商品图片
- `#landingImage` - 主图
- `#imgBlkFront` - 封面图
- `#main-image` - 主图像
- `#imageBlock_feature_div img` - 图片块中的图

## 🔧 使用方法

1. **访问Amazon商品页面**
   - 例如: https://www.amazon.com/.../dp/B0FQ2PL7SL/...

2. **触发分析**
   - 方式1: 右键点击页面 -> 选择"分析当前商品"
   - 方式2: 打开侧边栏 -> 切换到"分析"标签 -> 点击"分析商品"按钮

3. **查看结果**
   - 商品信息会自动提取
   - 分析结果会显示在侧边栏
   - 包含价格分析、风险评估、购买建议等

## 🐛 故障排查

### 问题1: 无法提取商品信息
**检查**:
- 打开浏览器控制台（F12），查看是否有错误
- 确认在商品详情页面（URL包含 `/dp/`）
- 查看console日志中的"提取到的商品信息"

**解决方案**:
- 刷新页面后重试
- 等待页面完全加载
- 检查扩展是否正确加载（chrome://extensions/）

### 问题2: 提取的信息不完整
**可能原因**:
- Amazon页面结构发生变化
- 页面是动态加载的，需要等待

**解决方案**:
- 系统会自动重试（最多3次）
- 如果仍然失败，会在侧边栏显示提示
- 可以手动在侧边栏输入商品信息

### 问题3: 价格提取不准确
**可能原因**:
- Amazon有多种价格显示方式（原价、优惠价、价格范围等）
- 价格可能是动态加载的

**解决方案**:
- 系统会尝试多种选择器
- 如果标准选择器失败，会从页面文本中搜索价格模式
- 可以在侧边栏手动输入价格

## 📊 提取的商品信息字段

```javascript
{
  name: "商品名称",
  price: 19.99,          // 数字类型
  image: "图片URL",
  productId: "B0FQ2PL7SL",  // ASIN
  asin: "B0FQ2PL7SL",       // 同productId
  rating: 4.5,              // 评分（可选）
  reviewCount: 1234,        // 评论数（可选）
  url: "当前页面URL",
  platform: "amazon",
  timestamp: 1234567890     // 时间戳
}
```

## 🔄 实时提取机制

系统确保每次分析时都使用最新的商品信息：

1. **分析前重置**: 清空旧的商品信息缓存
2. **重新提取**: 从当前页面提取最新信息
3. **重试机制**: 如果首次提取失败，等待后自动重试
4. **验证检查**: 确认提取的信息有效后才进行分析

## 🎯 测试建议

### 测试步骤：
1. 访问: https://www.amazon.com/.../dp/B0FQ2PL7SL/...
2. 等待页面完全加载
3. 打开浏览器控制台（F12）
4. 右键 -> "分析当前商品"
5. 查看控制台日志：
   - "开始提取商品信息，URL: ..."
   - "Amazon商品信息提取完成: {...}"
   - "商品信息提取成功，开始分析: {...}"

### 预期结果：
- ✅ 能够提取商品名称
- ✅ 能够提取商品价格
- ✅ 能够提取ASIN
- ✅ 分析结果正确显示

## 📝 支持的Amazon站点

- ✅ amazon.com (美国)
- ✅ amazon.cn (中国)
- ✅ 其他amazon.*域名

## 🔮 未来改进

- [ ] 支持Amazon Prime信息提取
- [ ] 支持多变体商品（如不同尺寸/颜色）
- [ ] 支持Amazon商品规格提取
- [ ] 优化价格提取准确率
- [ ] 支持Amazon优惠券信息

